{% extends "base.html.twig" %}

{% block body %}
	<div class="row h-50 overflow-auto col-12 justify-content-center mx-0 ">
		<h2 class="position-absolute rounded-pill text-center bg-white font-MF p-3" style="margin-top:15%;">{{ figure.name }}</h2>
		{% if figure.image %}
			<img src="{{ asset('uploads/home/' ~ figure.image) }}" alt="TrickSnow" class="mx-auto" height="500" width="100%">
		{% else %}
			<img src="{{ asset('uploads/home/Pardefault.jpg') }}" alt="" class="mx-auto" height="500" width="100%">
		{% endif %}
	</div>
	{% if app.user %}
		<div class="row position-absolute col-12 justify-content-end" style="top:60px;">
			<a href="{{ path('figure_edit', {'id': figure.id}) }}" class="bg-white p-2 border">&#128394;</a>
			<a href="{{ path('delete', {'entity': 'figure', 'id': figure.id}) }}" onclick="return confirm('Etes-vous sur de vouloir supprimer cette figure ?')" class="bg-white p-2 border">
				&#128465;</a>
		</div>
	{% endif %}
	<div class="row justify-content-start">
		{% for media in medias %}
			<article class="row col-md-2 h-25 m-3" id="{{media.id}}">
				{% if media.type == 'image' %}
					<img src="{{ media.url }}" alt="" width="100%" height="150px" class="mt-3 border">
				{% else %}
					<iframe src="{{ media.url }}" alt="" width="100%" height="150px" class="mt-3 border"></iframe>
				{% endif %}
				<div class="bg-white row w-100 justify-content-center ml-0">
					{% if app.user %}
						<a href="{{ path('delete', {'entity': 'media', 'id': media.id}) }}" onclick="return confirm('Etes-vous sur de vouloir supprimer cette figure ?')">
							&#128465;</a>
					{% endif %}
				</div>
			</article>
		{% endfor %}
	</div>
	<div class="col-9 p-2 mt-4 mx-auto bg-white rounded text-justify ">
		{{ figure.content }}
	</div>
	<div class="row justify-content-center border-white border-bottom p-3">
		{% if figure.dateLastUpdate is empty %}
			<div class="metadata rounded p-3 m-2 bg-primary text-white">Ecrit le
				{{ figure.dateCreated | date('d/m/Y')}}
				à
				{{ figure.dateCreated | date('H:i')}}
			</div>
		{% else %}
			<div class="metadata rounded p-3 m-2 bg-primary text-white">Dernière modification le
				{{ figure.dateLastUpdate | date('d/m/Y')}}
			</div>
		{% endif %}
		<div class="row rounded p-3 m-2 bg-primary text-white">
			<div>Auteur :&nbsp;</div>
			<div class="font-MF">
				{{ figure.user.username }}</div>
		</div>
		{% if figure.category %}
			<div class="row rounded p-3 m-2 bg-primary text-white">
				<div>Catégorie :&nbsp;</div>
				<div class="font-MF">{{ figure.category.name }}</div>
			</div>
		{% endif %}
	</div>

	<section id="commentaires">
		{% if app.user %}
			{{ form_start(formComment) }}
			<div class="row justify-content-center mt-4">
				<div class="col-lg-6 p-0">{{ form_row(formComment.content) }}</div>
				<div class="col-lg-3 p-0">
					<button type="submit" class="btn btn-success col-12">
						Laisser un commentaire
					</button>
				</div>
			</div>
			{{ form_end(formComment) }}
		{% else %}
			<div class="row justify-content-center p-3 border-white border-bottom">
				<div class="h2 col-12 text-center text-danger">
					Veuillez vous connecter pour commenter
				</div>
				<a href="{{path('security_login')}}" class="btn btn-danger">
					Connexion
				</a>
			</div>
		{% endif %}
		{% if figure.comments|length == 0 %}
			<div class="col-12 text-center text-success h3 p-3">
				Aucun commentaire sur cette figure
			</div>
		{% elseif figure.comments|length == 1 %}
			<div class="col-12 text-center text-success h3 p-3">
				Il y a
				{{ figure.comments | length }}
				commentaire :
			</div>
		{% else %}
			<div class="col-12 text-center text-success h3 p-3">
				Il y a
				{{ figure.comments | length }}
				commentaires :
			</div>
		{% endif %}

		{% for comment in figure.comments %}
			<div class="row offset-lg-1">
				<div class="col-1 d-none d-lg-block">
					{% if comment.user.image %}
						<img src="{{ asset('uploads/UserImg/' ~ comment.user.image) }}" class="rounded-circle border-success p-3" width="auto" height="100">
					{% else %}
						<img src="{{ asset('uploads/UserImg/anonymous.png') }}" class="rounded-circle border-success p-3" width="auto" height="100">
					{% endif %}
				</div>
				<div class="d-none d-lg-block col-lg-9 bg-white comment p-3 border border-success mb-3">
					<div class="row">
						<div class="col-3 border-right border-success">
							<div class="col font-MF text-success text-center">
								{{ comment.user.username }}
							</div>
							<div class="col text-success text-center">
								<small>le
									{{ comment.dateCreated | date('d/m/Y')}}
									à
									{{ comment.dateCreated | date('H:i')}}</small>
							</div>
						</div>
						<div class="col">
							{{ comment.content | raw }}
						</div>
						<div class="m-1">
							{% if app.user and user.username == comment.user.username %}
								<a href="{{ path('delete', {'entity': 'comment', 'id': comment.id}) }}" onclick="return confirm('Etes-vous sur de vouloir supprimer ce commentaire ?')" class="bg-white py-2 pl-2 pr-1 border border-danger">
									&#128465;
								</a>
							{% endif %}
						</div>
					</div>
				</div>
			</div>
			<div class="d-md-block d-lg-none col-12 bg-white comment p-3 border border-success mb-3">
				<div class="row">
					<div class="col-12 border-bottom border-success">
						<div class="col font-MF text-success text-center">
							{{ comment.user.username }}
						</div>
						<div class="col text-success text-center">
							<small>le
								{{ comment.dateCreated | date('d/m/Y')}}
								à
								{{ comment.dateCreated | date('H:i')}}</small>
						</div>
					</div>
					<div class="col">
						{{ comment.content | raw }}
					</div>
				</div>
			</div>
		</div>
	{% endfor %}
</section>{% endblock %}
