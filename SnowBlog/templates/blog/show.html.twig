{% extends "base.html.twig" %}

{% block body %}
	<div class="row h-50 col-12">
		<h2 class="position-absolute col-12 text-center bg-white font-MF p-2" style="margin-top:15%;">{{ figure.name }}</h2>
		<img src="{{ asset('uploads/home/' ~ figure.image) }}" alt="TrickSnow" class="mx-auto" height="500" width="auto">
	</div>
	<div class="row position-absolute col-12 justify-content-end" style="top:60px;">
		<a href="{{ path('blog_edit', {'id': figure.id}) }}" class="p-2">&#128394;</a>
		<a href="{{ path('delete', {'entity': 'figure', 'id': figure.id}) }}" onclick="return confirm('Etes-vous sur de vouloir supprimer cette figure ?')" class="p-2">
			&#128465;</a>
	</div>
	<div class="text-justify col-9 mx-auto">
		{{ figure.content }}
	</div>
	<div class="row overflow-auto justify-content-start">
		{% for media in medias %}
			<article class="mt-nav row col-md-2 h-25 m-3" id="{{media.id}}">
				{% if media.type == 'image' %}
					<img src="{{ media.file }}" alt="" width="100%" height="150px" class="mt-3 border">
				{% else %}
					<iframe src="{{ media.file }}" alt="" width="100%" height="150px" class="mt-3 border"></iframe>
				{% endif %}
				<div class="border border-primary row w-100 justify-content-between ml-0">
					{% if app.user %}
						<a href="{{ path('delete', {'entity': 'media', 'id': media.id}) }}" onclick="return confirm('Etes-vous sur de vouloir supprimer cette figure ?')">
							&#128465;</a>
					{% endif %}
				</div>
			</article>
		{% endfor %}
	</div>
	<div class="row justify-content-center border-primary border-bottom p-3">
		{% if figure.dateLastUpdate is empty %}
			<div class="metadata rounded p-3 m-2 bg-primary text-white">Ecrit le
				{{ figure.dateCreated | date('d/m/Y')}}
				à
				{{ figure.dateCreated | date('H:i')}}
			</div>
		{% else %}
			<div class="metadata rounded p-3 m-2 bg-primary text-white">Dernière modification le
				{{ figure.dateLastUpdate | date('d/m/Y')}}
			</div>
		{% endif %}
		<div class="row rounded p-3 m-2 bg-primary text-white">
			<div>Auteur :&nbsp;</div>
			<div class="font-MF"> {{ figure.user.username }}</div>
		</div>
		<div class="row rounded p-3 m-2 bg-primary text-white">
			<div>Catégorie :&nbsp;</div>
            <div class="font-MF">{{ figure.category.name }}</div>
		</div>
	</div>

	<section id="commentaires">
		{% if app.user %}
			{{ form_start(formForum) }}
			<div class="row justify-content-center mt-2">
				<div class="col-lg-6 p-0 mt-3">{{ form_row(formForum.content) }}</div>
				<div class="col-lg-3 p-0 mt-3">
					<button type="submit" class="btn btn-success">
						Laissez un commentaire
					</button>
				</div>
			</div>
			{{ form_end(formForum) }}
		{% else %}
			<div class="row justify-content-center p-3 border-primary border-bottom">
				<div class="h2 col-12 text-center text-danger">
					Veuillez vous connecter pour commenter
				</div>
				<a href="{{path('security_login')}}" class="btn btn-danger">
					Connexion
				</a>
			</div>
		{% endif %}
		{% if figure.forums|length == 0 %}
			<div class="text-center text-success h3 p-3">
				Aucun commentaire sur cette figure
			</div>
		{% elseif figure.forums|length == 1 %}
			<div class="text-center text-success h3 p-3">
				Il y a
				{{ figure.forums | length }}
				commentaire :
			</div>
		{% else %}
			<div class="text-center text-success h3 p-3">
				Il y a
				{{ figure.forums | length }}
				commentaires :
			</div>
		{% endif %}

		{% for forum in figure.forums %}
			<div class="comment p-3 border border-success mb-3">
				<div class="row">
					<div class="col font-MF text-success">
						{{ forum.user.username }}
					</div>
					<div class="col-12 text-success">
						<small>le {{ forum.dateCreated | date('d/m/Y')}} à {{ forum.dateCreated | date('H:i')}}</small>
					</div>
                    <div class="col-11 mx-auto border-bottom m-3"></div>
					<div class="col-12">
						{{ forum.content | raw }}</div>
				</div>
			</div>
		</div>
	{% endfor %}
</section>{% endblock %}
