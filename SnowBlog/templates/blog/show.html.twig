{% extends "base.html.twig" %}

{% block body %}
    <div {# class="container" #}>
        <h2 class="position-absolute col-12 text-center" style="margin-top:15%;">{{ figure.name }}</h2>
        <div class="row position-absolute justify-content-end col-12">
            <a href="{{ path('blog_edit', {'id': figure.id}) }}">&#128394;</a>
            <a href="{{ path('delete', {'entity': 'figure', 'id': figure.id}) }}" onclick="return confirm('Etes-vous sur de vouloir supprimer cette figure ?')">
                &#128465;</a>
        </div>
        <div>
            <div class="content">
                <img src="{{ asset('uploads/home/' ~ figure.image) }}" alt="TrickSnow" height="50%" width="auto">
                {{ figure.content }}
            </div>
            <div class="d-flex overflow-auto justify-content-start">
                {% for media in medias %}
                    <article class="mt-nav row col-lg-2 h-25 m-3" id="{{media.id}}">
                        {% if media.type == 'image' %}
                            <img src="{{ media.file }}" alt="" width="100%" height="150px" class="mt-3 border border-primary">
                            <div class="border border-primary row w-100 justify-content-between ml-0">
                                {% if app.user %}
                                    <a href="{{ path('delete', {'entity': 'media', 'id': media.id}) }}" onclick="return confirm('Etes-vous sur de vouloir supprimer cette figure ?')">
                                        &#128465;</a>
                                {% endif %}
                            </div>
                        {% else %}
                            <div id="youtube-ficha">
                                <iframe class="myIframe" width="100%" height="150px" frameborder="0" allowfullscreen></iframe>
                                <script type="text/javascript">

                                    var url = "{{ media.file }}";
                                    var id = url.split("?v=")[1]; // sGbxmsDFVnE

                                    var embedlink = "http://www.youtube.com/embed/" + id;

                                    var ytube1 = document.getElementsByClassName("myIframe");

                                    ytube1[{{ loop.index0 }}].src = embedlink;
                                </script>
                            </div>
                            <div class="border border-primary row w-100 justify-content-between ml-0">
                                {% if app.user %}
                                    <a href="{{ path('delete', {'entity': 'media', 'id': media.id}) }}" onclick="return confirm('Etes-vous sur de vouloir supprimer cette figure ?')">
                                        &#128465;</a>
                                {% endif %}
                            </div>
                        {% endif %}
                    </article>
                {% endfor %}
                <a href="{{ path('medias', {'id': figure.id}) }}">
                    Gérer les médias
                </a>
            </div>
            <div class="row justify-content-lg-center">
                {% if figure.dateLastUpdate is empty %}
                    <div class="metadata border border-primary">Ecrit le
                        {{ figure.dateCreated | date('d/m/Y')}}
                        à
                        {{ figure.dateCreated | date('H:i')}}
                    </div>
                {% endif %}
                <div class="metadata border border-primary">Dernière modification le
                    {{ figure.dateLastUpdate | date('d/m/Y')}}
                    à
                    {{ figure.dateLastUpdate | date('H:i')}}
                </div>
                <div class="text-success border border-primary">
                    Auteur :
                    {{ figure.user.username }}
                </div>
                <div class="text-success border border-primary">
                    Catégory :
                </div>
            </div>
        </div>

        <section id="commentaires">
            {% if figure.forums|length == 0 %}
                <h2>
                    Soyez le premier à discuter de cette figure :
                </h2>
            {% elseif figure.forums|length == 1 %}
                <h2>{{ figure.forums | length }}
                    Réponse :
                </h2>
            {% else %}
                <h2>{{ figure.forums | length }}
                    Réponses :
                </h2>
            {% endif %}
            {% for forum in figure.forums %}
                <div class="comment">
                    <div class="row">
                        <div class="col-3">
                            {{ forum.user.username }}
                            (<small>{{ forum.dateCreated | date('d/m/Y')}}</small>)
                            <div class="col">
                                {{ forum.content | raw }}</div>
                        </div>
                    </div>
                </div>
            {% endfor %}

            {% if app.user %}
                {{ form_start(formForum) }}
                <div class="border border-primrary">
                    {{ app.user.username }}
                </div>
                {{ form_row(formForum.content) }}
                <button type="submit" class="btn btn-success">
                    Répondre !
                </button>
                {{ form_end(formForum) }}

            {% else %}
                <h2>
                    Vous ne pouvez pas Répondre si vous n'êtes pas connecté !</h2>
                <a href="{{path('security_login')}}" class="btn btn-primary">
                    Connexion
                </a>
            {% endif %}

        </section>
    </div>
{% endblock %}
